group_by(accident_year, maturity) %>%
summarize(total_paid = sum(Total.Amount.Paid.Per.Line)) %>%
as.data.frame() %>%
spread(maturity, total_paid)
SV1_data %>%
mutate(accident_year = as.integer(Employee.Date.of.Injury / 100)) %>%
mutate(bill_year = as.integer(Date.of.Bill / 10000)) %>%
mutate(maturity = 12 * (bill_year - accident_year + 1)) %>%
group_by(accident_year, maturity) %>%
summarize(total_paid = sum(Total.Amount.Paid.Per.Line)) %>%
as.data.frame() %>%
spread(maturity, total_paid) %>%
replace_na("")
triangle_df <- SV1_data %>%
mutate(accident_year = as.integer(Employee.Date.of.Injury / 100)) %>%
mutate(bill_year = as.integer(Date.of.Bill / 10000)) %>%
mutate(maturity = 12 * (bill_year - accident_year + 1)) %>%
group_by(accident_year, maturity) %>%
summarize(total_paid = sum(Total.Amount.Paid.Per.Line)) %>%
as.data.frame() %>%
spread(maturity, total_paid)
# arrange(accident_year, maturity) %>%
# print(n = 100)
triangle_df
library(ChainLadder)
install.packages("ChainLadder")
library(ChainLadder)
triangle_object <- as.triangle(triangle_df, origin="ORIGIN", dev="DEV", value="VALUE")
triangle(triangle_df, origin="ORIGIN", dev="DEV", value="VALUE")
incr2cum(triangle_df)
ChainLadder::
ChainLadder::package
library(ChainLadder)
install.packages('actuar')
install.packages("actuar")
installlibrary(installr)
library(installr)
install.packages("installr")
library(installr)
updateR()
install.packages('actuar')
library(ChainLadder)
source("pathing_analysis_utils.R")
USER_ID <- "TK250052"
##connect to Teradata
con <- td_create_context(
host="tdprd.td.teradata.com", uid = USER_ID, pwd = getPass(),
dType = "native", logmech = "LDAP")
##setup parameters - this is true across ALL iterations
insurer_fein <- "848446466" # Travelers
#insurer_fein <- "726579180" # Texas Mutual
#insurer_fein <- "All"
#INITIAL_DIAGNOSIS <- "ALL"
INITIAL_DIAGNOSIS <- "S33.5XX"
#INITIAL_DIAGNOSIS <- "T14.90X"
#INITIAL_DIAGNOSIS <- "S39.012"
#INITIAL_DIAGNOSIS <- "S06.0X9"
MINIMUM_INJURY_YEAR <- 2017
MAXIMUM_INJURY_YEAR <- 2021
MINIMUM_BILL_DATE <- "20170000"
MAXIMUM_BILL_DATE <- "20210000"
##prepare the data
SV1_data <- get_SV1_data()
#add attributes by bill required to build up the triangle dimensions
triangle_df <- SV1_data %>%
mutate(accident_year = as.integer(Employee.Date.of.Injury / 100)) %>%
mutate(bill_year = as.integer(Date.of.Bill / 10000)) %>%
mutate(maturity = 12 * (bill_year - accident_year + 1)) %>%
group_by(accident_year, maturity) %>%
summarize(total_paid = sum(Total.Amount.Paid.Per.Line)) %>%
as.data.frame() %>%
spread(maturity, total_paid)
# arrange(accident_year, maturity) %>%
# print(n = 100)
library(dplyr)
library(dplyr)
install.packages("remotes")
library(ChainLadder)
source("pathing_analysis_utils.R")
USER_ID <- "TK250052"
##connect to Teradata
con <- td_create_context(
host="tdprd.td.teradata.com", uid = USER_ID, pwd = getPass(),
dType = "native", logmech = "LDAP")
install.packages("lubridate")
install.packages("getPass")
library(ChainLadder)
source("pathing_analysis_utils.R")
USER_ID <- "TK250052"
##connect to Teradata
con <- td_create_context(
host="tdprd.td.teradata.com", uid = USER_ID, pwd = getPass(),
dType = "native", logmech = "LDAP")
install.packages("pracma")
library(ChainLadder)
source("pathing_analysis_utils.R")
USER_ID <- "TK250052"
##connect to Teradata
con <- td_create_context(
host="tdprd.td.teradata.com", uid = USER_ID, pwd = getPass(),
dType = "native", logmech = "LDAP")
##setup parameters - this is true across ALL iterations
insurer_fein <- "848446466" # Travelers
#insurer_fein <- "726579180" # Texas Mutual
#insurer_fein <- "All"
#INITIAL_DIAGNOSIS <- "ALL"
INITIAL_DIAGNOSIS <- "S33.5XX"
#INITIAL_DIAGNOSIS <- "T14.90X"
#INITIAL_DIAGNOSIS <- "S39.012"
#INITIAL_DIAGNOSIS <- "S06.0X9"
MINIMUM_INJURY_YEAR <- 2017
MAXIMUM_INJURY_YEAR <- 2021
MINIMUM_BILL_DATE <- "20170000"
MAXIMUM_BILL_DATE <- "20210000"
##prepare the data
SV1_data <- get_SV1_data()
#add attributes by bill required to build up the triangle dimensions
triangle_df <- SV1_data %>%
mutate(accident_year = as.integer(Employee.Date.of.Injury / 100)) %>%
mutate(bill_year = as.integer(Date.of.Bill / 10000)) %>%
mutate(maturity = 12 * (bill_year - accident_year + 1)) %>%
group_by(accident_year, maturity) %>%
summarize(total_paid = sum(Total.Amount.Paid.Per.Line)) %>%
as.data.frame() %>%
spread(maturity, total_paid)
triangle_df
incr2cum(triangle_df)
incremental_triangle <- SV1_data %>%
mutate(accident_year = as.integer(Employee.Date.of.Injury / 100)) %>%
mutate(bill_year = as.integer(Date.of.Bill / 10000)) %>%
mutate(maturity = 12 * (bill_year - accident_year + 1)) %>%
group_by(accident_year, maturity) %>%
summarize(total_paid = sum(Total.Amount.Paid.Per.Line)) %>%
as.data.frame() %>%
spread(maturity, total_paid)
# arrange(accident_year, maturity) %>%
# print(n = 100)
cumulative_triangle <- incr2cum(triangle_df)
cumulative_triangle
library(ChainLadder)
source("pathing_analysis_utils.R")
USER_ID <- "TK250052"
##connect to Teradata
con <- td_create_context(
host="tdprd.td.teradata.com", uid = USER_ID, pwd = getPass(),
dType = "native", logmech = "LDAP")
##setup parameters - this is true across ALL iterations
insurer_fein <- "848446466" # Travelers
#insurer_fein <- "726579180" # Texas Mutual
#insurer_fein <- "All"
#INITIAL_DIAGNOSIS <- "ALL"
INITIAL_DIAGNOSIS <- "S33.5XX"
#INITIAL_DIAGNOSIS <- "T14.90X"
#INITIAL_DIAGNOSIS <- "S39.012"
#INITIAL_DIAGNOSIS <- "S06.0X9"
MINIMUM_INJURY_YEAR <- 2017
MAXIMUM_INJURY_YEAR <- 2021
MINIMUM_BILL_DATE <- "20170000"
MAXIMUM_BILL_DATE <- "20210000"
##prepare the data
SV1_data <- get_SV1_data()
#add attributes by bill required to build up the triangle dimensions
incremental_triangle <- SV1_data %>%
mutate(accident_year = as.integer(Employee.Date.of.Injury / 100)) %>%
mutate(bill_year = as.integer(Date.of.Bill / 10000)) %>%
mutate(maturity = 12 * (bill_year - accident_year + 1)) %>%
group_by(accident_year, maturity) %>%
summarize(total_paid = sum(Total.Amount.Paid.Per.Line)) %>%
as.data.frame() %>%
spread(maturity, total_paid)
# arrange(accident_year, maturity) %>%
# print(n = 100)
cumulative_triangle <- incr2cum(triangle_df)
cumulative_triangle <- incr2cum(incremental_triangle)
cumulative_triangle
##try again, first by separating out claims based on initial diagnosis
data_for_pathing <- get_data_for_pathing(SV1_data, "weekly")
data_for_pathing
filtered_for_duration <- adjust_for_intervals(data_for_pathing)
filtered_for_duration
filtered_for_duration_substituted <- substitute_diagnoses(filtered_for_duration)
filtered_for_duration_substituted
#synthesize activity for missing weeks
missing_weeks_added <- add_missing_weeks(filtered_for_duration_substituted)
missing_weeks_added
#nPath - for the particular diagnosis, carrier, dates
npath_result_substituted <- run_nPath(missing_weeks_added, "start")
SV1_data %>%
group_by(Claim.Administrator.Claim.Number) %>%
summarize() %>%
ungroup() %>%
count()
npath_result_substituted$result
npath_result_substituted$result %>%
rename(Claim.Administrator.Claim.Number = claim_number) %>%
group_by(Claim.Administrator.Claim.Number) %>%
summarize() %>%
ungroup() %>%
count()
all_claim_numbers <- SV1_data %>%
group_by(Claim.Administrator.Claim.Number) %>%
summarize()
all_claim_numbers %>%
ungroup() %>%
count()
initial_diagnosis_claim_numbers <- npath_result_substituted$result %>%
rename(Claim.Administrator.Claim.Number = claim_number) %>%
group_by(Claim.Administrator.Claim.Number) %>%
summarize()
initial_diagnosis_claim_numbers %>%
ungroup() %>%
count()
library(ChainLadder)
source("pathing_analysis_utils.R")
USER_ID <- "TK250052"
##connect to Teradata
con <- td_create_context(
host="tdprd.td.teradata.com", uid = USER_ID, pwd = getPass(),
dType = "native", logmech = "LDAP")
##setup parameters - this is true across ALL iterations
insurer_fein <- "848446466" # Travelers
#insurer_fein <- "726579180" # Texas Mutual
#insurer_fein <- "All"
#INITIAL_DIAGNOSIS <- "ALL"
INITIAL_DIAGNOSIS <- "S33.5XX"
#INITIAL_DIAGNOSIS <- "T14.90X"
#INITIAL_DIAGNOSIS <- "S39.012"
#INITIAL_DIAGNOSIS <- "S06.0X9"
MINIMUM_INJURY_YEAR <- 2017
MAXIMUM_INJURY_YEAR <- 2021
MINIMUM_BILL_DATE <- "20170000"
MAXIMUM_BILL_DATE <- "20210000"
#get data per the filters
SV1_data <- get_SV1_data()
#function to create a triangle
create_triangle <- function(tbl) {
incremental <- tbl %>%
mutate(accident_year = as.integer(Employee.Date.of.Injury / 100)) %>%
mutate(bill_year = as.integer(Date.of.Bill / 10000)) %>%
mutate(maturity = 12 * (bill_year - accident_year + 1)) %>%
group_by(accident_year, maturity) %>%
summarize(total_paid = sum(Total.Amount.Paid.Per.Line)) %>%
as.data.frame() %>%
spread(maturity, total_paid)
cumulative <- incr2cum(incremental_triangle)
}
#add attributes by bill required to build up the triangle dimensions
cumulative_triangle <- create_triangle(SV1_data)
create_triangle <- function(tbl) {
incremental <- tbl %>%
mutate(accident_year = as.integer(Employee.Date.of.Injury / 100)) %>%
mutate(bill_year = as.integer(Date.of.Bill / 10000)) %>%
mutate(maturity = 12 * (bill_year - accident_year + 1)) %>%
group_by(accident_year, maturity) %>%
summarize(total_paid = sum(Total.Amount.Paid.Per.Line)) %>%
as.data.frame() %>%
spread(maturity, total_paid)
cumulative <- incr2cum(incremental)
}
#add attributes by bill required to build up the triangle dimensions
cumulative_triangle <- create_triangle(SV1_data)
cumulative_triangle
data_for_pathing <- get_data_for_pathing(SV1_data, "weekly")
filtered_for_duration <- adjust_for_intervals(data_for_pathing)
filtered_for_duration_substituted <- substitute_diagnoses(filtered_for_duration)
#synthesize activity for missing weeks
missing_weeks_added <- add_missing_weeks(filtered_for_duration_substituted)
#nPath - for the particular diagnosis, carrier, dates
npath_result_substituted <- run_nPath(missing_weeks_added, "start")
#compare claim counts
all_claim_numbers <- SV1_data %>%
group_by(Claim.Administrator.Claim.Number) %>%
summarize()
all_claim_numbers %>%
ungroup() %>%
count()
initial_diagnosis_claim_numbers <- npath_result_substituted$result %>%
rename(Claim.Administrator.Claim.Number = claim_number) %>%
group_by(Claim.Administrator.Claim.Number) %>%
summarize()
initial_diagnosis_claim_numbers %>%
ungroup() %>%
count()
npath_result_substituted$result
initial_diagnosis_claim_numbers <- npath_result_substituted$result %>%
rename(Claim.Administrator.Claim.Number = claim_number) %>%
group_by(Claim.Administrator.Claim.Number) %>%
summarize()
initial_diagnosis_claim_numbers %>%
ungroup() %>%
count()
inner_join(SV1_data,
npath_result_substituted$result %>%
rename(Claim.Administrator.Claim.Number = claim_number),
by = "Claim.Administrator.Claim.Number"
)
inner_join(SV1_data,
initial_diagnosis_claim_numbers,
by = "Claim.Administrator.Claim.Number"
)
initial_diagnosis_claim_numbers
initial_diagnosis_claim_numbers <- npath_result_substituted$result %>%
mutate(claim_number = gsub("\\[", "", claim_number)) %>%
mutate(claim_number = gsub("\\]", "", claim_number)) %>%
rename(Claim.Administrator.Claim.Number = claim_number) %>%
group_by(Claim.Administrator.Claim.Number) %>%
summarize()
initial_diagnosis_claim_numbers %>%
ungroup() %>%
count()
inner_join(SV1_data,
initial_diagnosis_claim_numbers,
by = "Claim.Administrator.Claim.Number"
)
initial_diagnosis_data <- inner_join(SV1_data,
initial_diagnosis_claim_numbers,
by = "Claim.Administrator.Claim.Number"
)
create_triangle(initial_diagnosis_data)
initial_diagnosis_triangle <- create_triangle(initial_diagnosis_data)
initial_diagnosis_triangle
cumulative_triangle
ata(as.triangle(initial_diagnosis_triangle))
ata(as.triangle(cumulative_triangle))
library(ChainLadder)
source("pathing_analysis_utils.R")
USER_ID <- "TK250052"
##connect to Teradata
con <- td_create_context(
host="tdprd.td.teradata.com", uid = USER_ID, pwd = getPass(),
dType = "native", logmech = "LDAP")
##setup parameters - this is true across ALL iterations
insurer_fein <- "848446466" # Travelers
#insurer_fein <- "726579180" # Texas Mutual
#insurer_fein <- "All"
#INITIAL_DIAGNOSIS <- "ALL"
#INITIAL_DIAGNOSIS <- "S33.5XX"
INITIAL_DIAGNOSIS <- "T14.90X"
#INITIAL_DIAGNOSIS <- "S39.012"
#INITIAL_DIAGNOSIS <- "S06.0X9"
MINIMUM_INJURY_YEAR <- 2017
MAXIMUM_INJURY_YEAR <- 2021
MINIMUM_BILL_DATE <- "20170000"
MAXIMUM_BILL_DATE <- "20210000"
#get data per the filters
SV1_data <- get_SV1_data()
#function to create a triangle
create_triangle <- function(tbl) {
incremental <- tbl %>%
mutate(accident_year = as.integer(Employee.Date.of.Injury / 100)) %>%
mutate(bill_year = as.integer(Date.of.Bill / 10000)) %>%
mutate(maturity = 12 * (bill_year - accident_year + 1)) %>%
group_by(accident_year, maturity) %>%
summarize(total_paid = sum(Total.Amount.Paid.Per.Line)) %>%
as.data.frame() %>%
spread(maturity, total_paid)
cumulative <- incr2cum(incremental)
}
#add attributes by bill required to build up the triangle dimensions
cumulative_triangle <- create_triangle(SV1_data)
ata(as.triangle(cumulative_triangle))
##try again, first by separating out claims based on initial diagnosis
data_for_pathing <- get_data_for_pathing(SV1_data, "weekly")
filtered_for_duration <- adjust_for_intervals(data_for_pathing)
filtered_for_duration_substituted <- substitute_diagnoses(filtered_for_duration)
#synthesize activity for missing weeks
missing_weeks_added <- add_missing_weeks(filtered_for_duration_substituted)
#nPath - for the particular diagnosis, carrier, dates
npath_result_substituted <- run_nPath(missing_weeks_added, "start")
#compare claim counts
all_claim_numbers <- SV1_data %>%
group_by(Claim.Administrator.Claim.Number) %>%
summarize()
all_claim_numbers %>%
ungroup() %>%
count()
initial_diagnosis_claim_numbers <- npath_result_substituted$result %>%
mutate(claim_number = gsub("\\[", "", claim_number)) %>%
mutate(claim_number = gsub("\\]", "", claim_number)) %>%
rename(Claim.Administrator.Claim.Number = claim_number) %>%
group_by(Claim.Administrator.Claim.Number) %>%
summarize()
initial_diagnosis_claim_numbers %>%
ungroup() %>%
count()
npath_result_substituted$result
library(ChainLadder)
source("pathing_analysis_utils.R")
USER_ID <- "TK250052"
##connect to Teradata
con <- td_create_context(
host="tdprd.td.teradata.com", uid = USER_ID, pwd = getPass(),
dType = "native", logmech = "LDAP")
##setup parameters - this is true across ALL iterations
insurer_fein <- "848446466" # Travelers
#insurer_fein <- "726579180" # Texas Mutual
#insurer_fein <- "All"
#INITIAL_DIAGNOSIS <- "ALL"
#INITIAL_DIAGNOSIS <- "S33.5XX"
#INITIAL_DIAGNOSIS <- "T14.90X"
INITIAL_DIAGNOSIS <- "S39.012"
#INITIAL_DIAGNOSIS <- "S06.0X9"
MINIMUM_INJURY_YEAR <- 2017
MAXIMUM_INJURY_YEAR <- 2021
MINIMUM_BILL_DATE <- "20170000"
MAXIMUM_BILL_DATE <- "20210000"
#get data per the filters
SV1_data <- get_SV1_data()
#function to create a triangle
create_triangle <- function(tbl) {
incremental <- tbl %>%
mutate(accident_year = as.integer(Employee.Date.of.Injury / 100)) %>%
mutate(bill_year = as.integer(Date.of.Bill / 10000)) %>%
mutate(maturity = 12 * (bill_year - accident_year + 1)) %>%
group_by(accident_year, maturity) %>%
summarize(total_paid = sum(Total.Amount.Paid.Per.Line)) %>%
as.data.frame() %>%
spread(maturity, total_paid)
cumulative <- incr2cum(incremental)
}
#add attributes by bill required to build up the triangle dimensions
cumulative_triangle <- create_triangle(SV1_data)
ata(as.triangle(cumulative_triangle))
##try again, first by separating out claims based on initial diagnosis
data_for_pathing <- get_data_for_pathing(SV1_data, "weekly")
filtered_for_duration <- adjust_for_intervals(data_for_pathing)
filtered_for_duration_substituted <- substitute_diagnoses(filtered_for_duration)
#synthesize activity for missing weeks
missing_weeks_added <- add_missing_weeks(filtered_for_duration_substituted)
#nPath - for the particular diagnosis, carrier, dates
npath_result_substituted <- run_nPath(missing_weeks_added, "start")
all_claim_numbers <- SV1_data %>%
group_by(Claim.Administrator.Claim.Number) %>%
summarize()
all_claim_numbers %>%
ungroup() %>%
count()
npath_result_substituted$result
initial_diagnosis_claim_numbers <- npath_result_substituted$result %>%
mutate(claim_number = gsub("\\[", "", claim_number)) %>%
mutate(claim_number = gsub("\\]", "", claim_number)) %>%
rename(Claim.Administrator.Claim.Number = claim_number) %>%
group_by(Claim.Administrator.Claim.Number) %>%
summarize()
initial_diagnosis_claim_numbers %>%
ungroup() %>%
count()
initial_diagnosis_data <- inner_join(SV1_data,
initial_diagnosis_claim_numbers,
by = "Claim.Administrator.Claim.Number"
)
initial_diagnosis_triangle <- create_triangle(initial_diagnosis_data)
ata(as.triangle(initial_diagnosis_triangle))
#INITIAL_DIAGNOSIS <- "ALL"
#INITIAL_DIAGNOSIS <- "S33.5XX"
#INITIAL_DIAGNOSIS <- "T14.90X"
#INITIAL_DIAGNOSIS <- "S39.012"
INITIAL_DIAGNOSIS <- "S06.0X9"
data_for_pathing <- get_data_for_pathing(SV1_data, "weekly")
filtered_for_duration <- adjust_for_intervals(data_for_pathing)
filtered_for_duration_substituted <- substitute_diagnoses(filtered_for_duration)
#synthesize activity for missing weeks
missing_weeks_added <- add_missing_weeks(filtered_for_duration_substituted)
#nPath - for the particular diagnosis, carrier, dates
npath_result_substituted <- run_nPath(missing_weeks_added, "start")
#compare claim counts
all_claim_numbers <- SV1_data %>%
group_by(Claim.Administrator.Claim.Number) %>%
summarize()
all_claim_numbers %>%
ungroup() %>%
count()
npath_result_substituted$result
initial_diagnosis_claim_numbers <- npath_result_substituted$result %>%
mutate(claim_number = gsub("\\[", "", claim_number)) %>%
mutate(claim_number = gsub("\\]", "", claim_number)) %>%
rename(Claim.Administrator.Claim.Number = claim_number) %>%
group_by(Claim.Administrator.Claim.Number) %>%
summarize()
initial_diagnosis_claim_numbers %>%
ungroup() %>%
count()
data_for_pathing <- get_data_for_pathing(SV1_data, "weekly")
filtered_for_duration <- adjust_for_intervals(data_for_pathing)
filtered_for_duration_substituted <- substitute_diagnoses(filtered_for_duration)
#synthesize activity for missing weeks
missing_weeks_added <- add_missing_weeks(filtered_for_duration_substituted)
#nPath - for the particular diagnosis, carrier, dates
npath_result_substituted <- run_nPath(missing_weeks_added, "start")
#compare claim counts
all_claim_numbers <- SV1_data %>%
group_by(Claim.Administrator.Claim.Number) %>%
summarize()
all_claim_numbers %>%
ungroup() %>%
count()
npath_result_substituted$result
initial_diagnosis_claim_numbers <- npath_result_substituted$result %>%
mutate(claim_number = gsub("\\[", "", claim_number)) %>%
mutate(claim_number = gsub("\\]", "", claim_number)) %>%
rename(Claim.Administrator.Claim.Number = claim_number) %>%
group_by(Claim.Administrator.Claim.Number) %>%
summarize()
initial_diagnosis_claim_numbers %>%
ungroup() %>%
count()
initial_diagnosis_data <- inner_join(SV1_data,
initial_diagnosis_claim_numbers,
by = "Claim.Administrator.Claim.Number"
)
initial_diagnosis_triangle <- create_triangle(initial_diagnosis_data)
ata(as.triangle(initial_diagnosis_triangle))
